---
title: "ABC Bank Customer Churn"
author: "T4"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: true
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---
```{r init, include=FALSE}
library(ezids)
library(vtable)
loadPkg("Hmisc") 
library(dplyr)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
```

# EDA

**Reading the file with all the customer churn details as a data frame.Then displaying the structure of the data frame**

```{r Churn_data_file, include=T,echo=TRUE,results="rpois"}
churn_data<-data.frame(read.csv("Bank_Customer_Churn_Prediction.csv",header=TRUE))
str(churn_data)
```
The churn data frame as `r nrow(churn_data)` observations with `r ncol(churn_data)` variables.


**Checking for duplicates in the data frame.**
```{r duplicates}
nrow(unique(churn_data))
```

There are `r nrow(unique(churn_data))` rows of unique records in the data.Hence we the data frame has no duplicates records.We can proceed with next step of analysis.


**Checking for summary of the churn data frame.**

```{r churn_summary,results='apois'}
summary(churn_data)
```

## Independent variable EDA

**Converting Boolean values into desired values **
```{r bool_conversion,results='apois'}
churn_data$credit_card <- as.character(churn_data$credit_card)
churn_data$active_member <- as.character(churn_data$active_member)
churn_data$churn <- as.character(churn_data$churn)

require(dplyr)
customer_updated <- churn_data %>% mutate(credit_card = ifelse(credit_card == "Credit_Card",1,0) )
head(customer_updated)


```

**Checking for outliers in the data frame  for credit_score,age,tenure,balance,estimated_salary variables  using outlierKD function.**

```{r credit_score}
credit_score_clean <- outlierKD2(churn_data, credit_score, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
xkablesummary(credit_score_clean)
```
The proportion outliers for age variable if 0.2% and it was removed succesfully using outlierKD function.


```{r age}
age_clean <- outlierKD2(churn_data, age, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
xkablesummary(age_clean)
```
The proportion outliers for age variable if 3.7% and it was removed succesfully using outlierKD function.


```{r tenure}
tenure_clean <- outlierKD2(churn_data, tenure, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
xkablesummary(tenure_clean)
```
There is no outliers found for tenure variable.


```{r balance}
balance_clean <- outlierKD2(churn_data, balance, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
xkablesummary(balance_clean)
```
There is no outliers found for balance variable.


```{r estimated_salary}
salary_clean <- outlierKD2(churn_data, estimated_salary, rm = TRUE, boxplt = TRUE, qqplt = TRUE)
xkablesummary(salary_clean)
```
There is no outliers found for salary variable.




```{r credit card-churn}
churn_data[, 11:12][churn_data[, 11:12] == 1] <- 'Churn'
churn_data[, 11:12][churn_data[, 11:12] == 0] <- 'No Churn'

cc_churn <- table(churn_data$churn, churn_data$credit_card)
cc_churn

chitestccchurn <- chisq.test(cc_churn)
chitestccchurn
```
Credit Card vs Churn
P-value of 0.5 is much higher that the significance level (0.05 for df=1). Thus, we reject the null hypothesis, as there is a 0.5 or 50% chance of these results occuring by chance. We can conclude that there is no relationship between whether a user has a credit card, and churn.

```{r}

library(ggplot2)

ggplot(churn_data, aes(fill=churn, y=churn, x=credit_card)) + 
  geom_bar(position='stack', stat='identity') + theme_minimal() + 
  labs(x='Credit Card', y='Number of Customers', title='Customer Churn in Customers with and without Credit Cards')  +
  scale_fill_manual('Position', values=c('red', 'lightblue'))
```

